<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Scrum Update Tracker</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 16px; }
      textarea { width: 100%; height: 180px; }
      .row { margin-top: 12px; display: flex; gap: 8px; }
      pre { white-space: pre-wrap; }
      .muted { color: #666; font-size: 12px; }
    </style>
    <style>
    @media (prefers-color-scheme: dark) {
      body { background: #1e1e1e; color: #e0e0e0; }
      textarea { background: #2b2b2b; color: #e0e0e0; border: 1px solid #3c3c3c; }
      button { background: #3a3a3a; color: #fff; border: 1px solid #555; }
      .muted { color: #aaaaaa; }
    }
    </style>
  </head>
  <body>
    <div id="input-view" style="display:none">
      <h3>What are you working on?</h3>
      <textarea id="entry" placeholder="Short bullet(s) â€” what you did since the last prompt, blockers, next task..."></textarea>
      <div class="row">
        <button id="save">Save</button>
        <button id="skip">Skip</button>
        <span class="muted" id="count"></span>
      </div>
    </div>

    <div id="summary-view" style="display:none">
      <h3>Daily Summary</h3>
      <div class="row">
        <button id="refresh">Re-summarize</button>
        <span class="muted">Copied to clipboard on summarize</span>
      </div>
      <pre id="summary"></pre>
      <h4>Today's entries</h4>
      <div id="entries"></div>
    </div>

    <script>
      const $ = (s) => document.querySelector(s);
      let mode = 'input';

      function setMode(m) {
        mode = m;
        $('#input-view').style.display = m === 'input' ? 'block' : 'none';
        $('#summary-view').style.display = m === 'summary' ? 'block' : 'none';
      }

      window.scrum.onMode(({ mode, content }) => {
        setMode(mode);
        if (mode === 'input') {
          $('#entry').value = '';
          window.scrum.getToday().then(list => $('#count').textContent = `${list.length} entries today`);
          $('#entry').focus();
        } else if (mode === 'summary') {
          $('#summary').textContent = content || '';
          renderEntries();
          if (!content) {
            window.scrum.summarizeNow().then(s => {
              $('#summary').textContent = s || '';
            });
          }
        }
      });

      function renderEntries() {
        window.scrum.getToday().then(list => {
          const container = $('#entries');
          container.innerHTML = '';
          if (!list || list.length === 0) {
            const p = document.createElement('p');
            p.className = 'muted';
            p.textContent = 'No entries today.';
            container.appendChild(p);
            return;
          }
          const ul = document.createElement('ul');
          ul.style.paddingLeft = '18px';
          list
            .sort((a, b) => new Date(a.ts) - new Date(b.ts))
            .forEach(e => {
              const li = document.createElement('li');
              const time = new Date(e.ts).toLocaleTimeString();
              li.textContent = `[${time}] ${e.text}`;
              ul.appendChild(li);
            });
          container.appendChild(ul);
        });
      }

      $('#save').addEventListener('click', async () => {
        await window.scrum.saveEntry($('#entry').value);
        await window.scrum.hideWindow();
      });
      $('#skip').addEventListener('click', async () => {
        await window.scrum.hideWindow();
      });
      // Enter to submit, Shift+Enter for newline
      $('#entry').addEventListener('keydown', async (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          await window.scrum.saveEntry($('#entry').value);
          await window.scrum.hideWindow();
        }
      });
      $('#refresh').addEventListener('click', async () => {
        const s = await window.scrum.summarizeNow();
        $('#summary').textContent = s;
        renderEntries();
      });

      // default view when opened manually
      setMode('input');
      window.scrum.getToday().then(list => $('#count').textContent = `${list.length} entries today`);
    </script>
  </body>
  </html>

