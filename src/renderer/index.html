<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Scrum Update Tracker</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'">
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
      .app { display: grid; grid-template-columns: 260px 1fr; height: 100vh; }
      .sidebar { border-right: 1px solid #ddd; padding: 12px; overflow: auto; }
      .content { padding: 16px; overflow: auto; }
      textarea { width: 100%; height: 160px; }
      .row { margin-top: 12px; display: flex; gap: 8px; }
      pre { white-space: pre-wrap; }
      .muted { color: #666; font-size: 12px; }
      .entry-header { display: flex; justify-content: space-between; align-items: center; }
      .entry-list { margin: 8px 0 0; padding-left: 18px; }
      .collapse-btn { cursor: pointer; }
    </style>
    <style>
    @media (prefers-color-scheme: dark) {
      body { background: #1e1e1e; color: #e0e0e0; }
      textarea { background: #2b2b2b; color: #e0e0e0; border: 1px solid #3c3c3c; }
      button { background: #3a3a3a; color: #fff; border: 1px solid #555; }
      .muted { color: #aaaaaa; }
    }
    </style>
  </head>
  <body>
    <div class="app">
      <aside class="sidebar">
        <div class="entry-header">
          <h4 style="margin:0">Today</h4>
          <button id="toggle-entries" class="collapse-btn">Collapse</button>
        </div>
        <div id="entries-container">
          <div class="muted" id="count" style="margin-top:6px"></div>
          <ul id="entries" class="entry-list"></ul>
        </div>
      </aside>
      <main class="content">
        <div id="input-panel" style="display:none">
          <h3>What are you working on?</h3>
          <textarea id="entry" placeholder="Short bullet(s) â€” what you did since the last prompt, blockers, next task..."></textarea>
          <div class="row">
            <button id="save">Save</button>
            <button id="skip">Close</button>
          </div>
        </div>
        <div id="summary-panel" style="display:none">
          <h3>Daily Summary</h3>
          <div class="row">
            <button id="refresh">Re-summarize</button>
            <span class="muted">Copied to clipboard on summarize</span>
          </div>
          <pre id="summary"></pre>
        </div>
      </main>
    </div>

    <script>
      const $ = (s) => document.querySelector(s);
      let mode = 'input';

      function setMode(m) {
        mode = m;
        $('#input-panel').style.display = m === 'input' ? 'block' : 'none';
        $('#summary-panel').style.display = m === 'summary' ? 'block' : 'none';
      }

      window.scrum.onMode(({ mode, content }) => {
        setMode(mode);
        if (mode === 'input') {
          $('#entry').value = '';
          updateEntries();
          $('#entry').focus();
        } else if (mode === 'summary') {
          $('#summary').textContent = content || '';
          updateEntries();
          if (!content) {
            window.scrum.summarizeNow().then(s => {
              $('#summary').textContent = s || '';
            });
          }
        }
      });

      function updateEntries() {
        window.scrum.getToday().then(list => {
          const countEl = $('#count');
          countEl.textContent = `${(list || []).length} entries today`;
          const ul = $('#entries');
          ul.innerHTML = '';
          if (!list || list.length === 0) {
            return;
          }
          list
            .sort((a, b) => new Date(a.ts) - new Date(b.ts))
            .forEach(e => {
              const li = document.createElement('li');
              const time = new Date(e.ts).toLocaleTimeString();
              li.textContent = `[${time}] ${e.text}`;
              ul.appendChild(li);
            });
        });
      }

      $('#save').addEventListener('click', async () => {
        await window.scrum.saveEntry($('#entry').value);
        updateEntries();
      });
      $('#skip').addEventListener('click', async () => {
        await window.scrum.hideWindow();
      });
      // Enter to submit, Shift+Enter for newline
      $('#entry').addEventListener('keydown', async (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          await window.scrum.saveEntry($('#entry').value);
          updateEntries();
        }
      });
      $('#refresh').addEventListener('click', async () => {
        const s = await window.scrum.summarizeNow();
        $('#summary').textContent = s;
        updateEntries();
      });

      // Collapse/expand entries
      let collapsed = false;
      $('#toggle-entries').addEventListener('click', () => {
        collapsed = !collapsed;
        $('#entries-container').style.display = collapsed ? 'none' : 'block';
        $('#toggle-entries').textContent = collapsed ? 'Expand' : 'Collapse';
      });

      // default view when opened manually
      setMode('input');
      updateEntries();
    </script>
  </body>
  </html>

